<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Der OÖ-Plan | Unsere Mitmach-Plattform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .spoe-red { background-color: #E30613; }
        .spoe-red-text { color: #E30613; }
        .btn-primary { background-color: #E30613; color: white; font-weight: 600; border-radius: 8px; padding: 10px 20px; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #c00511; }
        .card { background-color: white; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .feed-icon { width: 20px; height: 20px; }
        .active-filter { background-color: #E30613; color: white; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, onSnapshot, addDoc, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQ8p3QttWNnNpxGp2Y-IiDxHJr6uHuBRw",
            authDomain: "spoe-7de91.firebaseapp.com",
            projectId: "spoe-7de91",
            storageBucket: "spoe-7de91.appspot.com",
            messagingSenderId: "216443796994",
            appId: "1:216443796994:web:a8c46d9f024ceec44f311b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const feedContainer = document.getElementById('feed-container');
        const ideaForm = document.getElementById('idea-form');
        const ideaTextarea = document.getElementById('idea-textarea');
        const aiHelperBtn = document.getElementById('ai-helper-btn');
        
        // --- Real-time Feed Listener ---
        const ideasCol = collection(db, 'ideas');
        onSnapshot(ideasCol, (snapshot) => {
            feedContainer.innerHTML = ''; // Clear existing feed
            snapshot.docs.forEach(doc => {
                const idea = doc.data();
                const ideaElement = createIdeaElement(doc.id, idea);
                feedContainer.appendChild(ideaElement);
            });
        });

        // --- Create Idea Element ---
        function createIdeaElement(id, idea) {
            const div = document.createElement('div');
            div.className = 'card p-4';
            div.innerHTML = `
                <div class="flex items-center mb-3">
                    <img src="https://placehold.co/40x40/cccccc/000000?text=${idea.author.charAt(0)}" class="rounded-full mr-3">
                    <div>
                        <p class="font-bold">${idea.author}</p>
                        <p class="text-xs text-gray-500">${idea.location} - ${new Date(idea.timestamp?.toDate()).toLocaleString('de-DE')}</p>
                    </div>
                </div>
                <p class="mb-4">${idea.text}</p>
                <div class="flex justify-between items-center border-t pt-2">
                    <div class="flex space-x-4">
                        <button data-id="${id}" class="like-btn flex items-center space-x-1 text-gray-600 hover:spoe-red-text">
                            <i data-lucide="thumbs-up" class="feed-icon"></i>
                            <span>${idea.likes || 0}</span>
                        </button>
                        <button class="flex items-center space-x-1 text-gray-600 hover:spoe-red-text">
                            <i data-lucide="message-square" class="feed-icon"></i>
                            <span>${idea.comments || 0}</span>
                        </button>
                    </div>
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${idea.inProgress ? 'bg-yellow-200 text-yellow-800' : 'bg-green-200 text-green-800'}">
                        ${idea.inProgress ? 'In Prüfung' : 'Idee gesammelt'}
                    </span>
                </div>
            `;
            lucide.createIcons({
                nodes: [div]
            });
            return div;
        }

        // --- Handle Likes ---
        document.addEventListener('click', async (e) => {
            if (e.target.closest('.like-btn')) {
                const btn = e.target.closest('.like-btn');
                const id = btn.dataset.id;
                const ideaRef = doc(db, 'ideas', id);
                await updateDoc(ideaRef, {
                    likes: increment(1)
                });
            }
        });

        // --- Handle Idea Submission ---
        ideaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = ideaTextarea.value;
            if (text.trim() === '') return;

            await addDoc(ideasCol, {
                author: "Andreas N.", // Placeholder for logged-in user
                location: "Linz", // Placeholder
                text: text,
                likes: 0,
                comments: 0,
                inProgress: false,
                timestamp: new Date()
            });

            ideaTextarea.value = '';
        });
        
        // --- AI Helper (Mock) ---
        aiHelperBtn.addEventListener('click', () => {
            const currentText = ideaTextarea.value;
            // Mock AI interaction
            const improvedText = `**Zusammenfassung:** ${currentText}\n\n**Vorschlag:** Wir könnten [konkrete Maßnahme] umsetzen, um [Ziel] zu erreichen. Ähnliche erfolgreiche Projekte gab es bereits in [Gemeinde X] (siehe Spritzerstand 2023, Kosten: €350, Helfer: 5).`;
            ideaTextarea.value = improvedText;
            alert("KI-Assistent hat deinen Beitrag optimiert!");
        });

    </script>

    <!-- Main Layout -->
    <div class="min-h-screen flex">
        <!-- Left Sidebar (Navigation) -->
        <aside class="w-1/5 bg-white p-6 hidden md:block shadow-lg">
            <div class="flex items-center mb-8">
                <svg class="h-10 w-auto spoe-red-text" viewBox="0 0 100 100" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M50 0C22.4 0 0 22.4 0 50s22.4 50 50 50 50-22.4 50-50S77.6 0 50 0z"/><path d="M50 30c-11 0-20 9-20 20s9 20 20 20 20-9 20-20-9-20-20-20z"/></svg>
                <span class="ml-3 text-xl font-bold">Der OÖ-Plan</span>
            </div>
            <nav class="space-y-2">
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg bg-red-100 spoe-red-text"><i data-lucide="home" class="mr-3"></i> Home / Feed</a>
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100"><i data-lucide="bar-chart-2" class="mr-3"></i> Abstimmungen</a>
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100"><i data-lucide="calendar" class="mr-3"></i> Veranstaltungen</a>
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100"><i data-lucide="users" class="mr-3"></i> Gruppen</a>
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100"><i data-lucide="book-open" class="mr-3"></i> Bildungsangebote</a>
                <a href="#" class="flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100"><i data-lucide="wrench" class="mr-3"></i> Toolbox</a>
            </nav>
            <div class="mt-10 p-4 bg-red-50 rounded-lg">
                <h3 class="font-bold spoe-red-text">KI-Workshops für Mandatare</h3>
                <p class="text-sm mt-2">Lerne, wie du KI für deine politische Arbeit nutzen kannst. Nächster Termin: 15.09.</p>
                <a href="#" class="text-sm font-semibold spoe-red-text mt-2 block">Jetzt anmelden &rarr;</a>
            </div>
        </aside>

        <!-- Center (Main Feed) -->
        <main class="w-full md:w-3/5 p-4 md:p-8 overflow-y-auto">
            <!-- "Was gibt's Neues?" Input Card -->
            <div class="card p-4 mb-6">
                <h2 class="text-xl font-bold mb-4">Gestalte OÖ mit! Was ist deine Idee?</h2>
                <form id="idea-form">
                    <textarea id="idea-textarea" class="w-full p-2 border rounded-lg" rows="4" placeholder="Beschreibe deine Idee, deinen Wunsch oder dein Anliegen..."></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <button type="button" id="ai-helper-btn" class="flex items-center text-sm text-gray-600 hover:spoe-red-text">
                            <i data-lucide="sparkles" class="mr-1 w-4 h-4"></i> Mit KI-Assistent verbessern
                        </button>
                        <button type="submit" class="btn-primary">Veröffentlichen</button>
                    </div>
                </form>
            </div>

            <!-- Feed Filter -->
            <div class="flex space-x-2 mb-4">
                <button class="px-4 py-1 text-sm font-semibold rounded-full active-filter">Alles</button>
                <button class="px-4 py-1 text-sm font-semibold rounded-full bg-white hover:bg-gray-200">Meine Gemeinde</button>
                <button class="px-4 py-1 text-sm font-semibold rounded-full bg-white hover:bg-gray-200">Mein Bezirk</button>
            </div>

            <!-- Dynamic Feed Container -->
            <div id="feed-container" class="space-y-4">
                <!-- Feed items will be injected here by JavaScript -->
                <div class="card p-4 text-center text-gray-500">Lade Ideen...</div>
            </div>
        </main>

        <!-- Right Sidebar (Martin Winkler & Top-Themen) -->
        <aside class="w-1/5 bg-transparent p-6 hidden md:block">
            <div class="card p-4 mb-6 text-center">
                <img src="https://placehold.co/80x80/E30613/FFFFFF?text=MW" alt="Martin Winkler" class="rounded-full mx-auto mb-3">
                <h3 class="font-bold">Martin Winkler</h3>
                <p class="text-sm text-gray-600 mb-3">Unser Mann für OÖ</p>
                <p class="text-sm">"Wir übernehmen den Landtag nicht als Vision, sondern als Ziel. Diese Plattform ist unser Plan. Wir setzen um, wir reden nicht nur."</p>
            </div>
            <div class="card p-4">
                <h3 class="font-bold mb-3">Top-Thema des Monats</h3>
                <div class="space-y-3">
                    <div class="bg-red-50 p-3 rounded-lg">
                        <p class="text-sm font-bold">#LeistbaresWohnen</p>
                        <p class="text-xs mt-1">Die Community hat gevotet! Diesen Monat bündeln wir alle Kräfte für faire Mieten und mehr Gemeindewohnungen.</p>
                        <a href="#" class="text-xs font-semibold spoe-red-text mt-1 block">Mitmachen &rarr;</a>
                    </div>
                </div>
            </div>
             <div class="card p-4 mt-6">
                <h3 class="font-bold mb-3">KI-Analyse: Polit-Check</h3>
                <p class="text-sm">Unsere KI hat die letzte Rede des politischen Mitbewerbers analysiert. Hier sind die Fakten und unsere Antwortvorschläge.</p>
                <a href="#" class="text-sm font-semibold spoe-red-text mt-2 block">Zur Analyse &rarr;</a>
            </div>
        </aside>
    </div>

    <script>
        lucide.createIcons();
    </script>
</body>
</html>
