<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Der OÖ-Plan | Unsere Mitmach-Plattform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .spoe-red { background-color: #E30613; }
        .spoe-red-text { color: #E30613; }
        .btn-primary { background-color: #E30613; color: white; font-weight: 600; border-radius: 8px; padding: 10px 20px; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #c00511; }
        .card { background-color: white; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .feed-icon { width: 20px; height: 20px; }
        .nav-link.active { background-color: #fee2e2; color: #E30613; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, increment, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQ8p3QttWNnNpxGp2Y-IiDxHJr6uHuBRw",
            authDomain: "spoe-7de91.firebaseapp.com",
            projectId: "spoe-7de91",
            storageBucket: "spoe-7de91.appspot.com",
            messagingSenderId: "216443796994",
            appId: "1:216443796994:web:a8c46d9f024ceec44f311b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const feedContainer = document.getElementById('feed-container');
        const ideaForm = document.getElementById('idea-form');
        const ideaTextarea = document.getElementById('idea-textarea');
        const aiHelperBtn = document.getElementById('ai-helper-btn');
        const mainContentTitle = document.getElementById('main-content-title');
        const navLinks = document.querySelectorAll('.nav-link');
        const contentPages = document.querySelectorAll('.content-page');
        
        // --- Real-time Feed Listener (sorted by timestamp) ---
        const ideasCol = collection(db, 'ideas');
        const q = query(ideasCol, orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            feedContainer.innerHTML = ''; // Clear existing feed
            if (snapshot.empty) {
                feedContainer.innerHTML = '<div class="card p-4 text-center text-gray-500">Noch keine Ideen vorhanden. Sei der/die Erste!</div>';
            } else {
                snapshot.docs.forEach(doc => {
                    const idea = doc.data();
                    const ideaElement = createIdeaElement(doc.id, idea);
                    feedContainer.appendChild(ideaElement);
                });
            }
        });

        // --- Create Idea Element ---
        function createIdeaElement(id, idea) {
            const div = document.createElement('div');
            div.className = 'card p-4';
            const timestamp = idea.timestamp ? new Date(idea.timestamp.toDate()).toLocaleString('de-DE') : 'gerade eben';
            div.innerHTML = `
                <div class="flex items-center mb-3">
                    <img src="https://placehold.co/40x40/cccccc/000000?text=${idea.author.charAt(0)}" class="rounded-full mr-3">
                    <div>
                        <p class="font-bold">${idea.author}</p>
                        <p class="text-xs text-gray-500">${idea.location} - ${timestamp}</p>
                    </div>
                </div>
                <p class="mb-4 whitespace-pre-wrap">${idea.text}</p>
                <div class="flex justify-between items-center border-t pt-2">
                    <div class="flex space-x-4">
                        <button data-id="${id}" class="like-btn flex items-center space-x-1 text-gray-600 hover:spoe-red-text">
                            <i data-lucide="thumbs-up" class="feed-icon"></i>
                            <span>${idea.likes || 0}</span>
                        </button>
                        <button class="flex items-center space-x-1 text-gray-600 hover:spoe-red-text">
                            <i data-lucide="message-square" class="feed-icon"></i>
                            <span>${idea.comments || 0}</span>
                        </button>
                    </div>
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${idea.inProgress ? 'bg-yellow-200 text-yellow-800' : 'bg-green-200 text-green-800'}">
                        ${idea.inProgress ? 'In Prüfung' : 'Idee gesammelt'}
                    </span>
                </div>
            `;
            lucide.createIcons({ nodes: [div] });
            return div;
        }

        // --- Handle Likes ---
        document.addEventListener('click', async (e) => {
            const likeBtn = e.target.closest('.like-btn');
            if (likeBtn) {
                const id = likeBtn.dataset.id;
                const ideaRef = doc(db, 'ideas', id);
                await updateDoc(ideaRef, { likes: increment(1) });
            }
        });

        // --- Handle Idea Submission ---
        ideaForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = ideaTextarea.value;
            if (text.trim() === '') return;

            await addDoc(ideasCol, {
                author: "Andreas N.", // Placeholder for logged-in user
                location: "Linz", // Placeholder
                text: text,
                likes: 0,
                comments: 0,
                inProgress: false,
                timestamp: new Date()
            });

            ideaTextarea.value = '';
        });
        
        // --- AI Helper (Mock) ---
        aiHelperBtn.addEventListener('click', () => {
            const currentText = ideaTextarea.value;
            const improvedText = `**Problem:** ${currentText}\n\n**Lösungsvorschlag:** Wir könnten [konkrete Maßnahme] umsetzen, um [Ziel] zu erreichen.\n\n**Referenz:** Ähnliche Projekte gab es bereits in [Gemeinde X] (siehe Spritzerstand 2023, Kosten: €350, Helfer: 5).`;
            ideaTextarea.value = improvedText;
            const modal = document.getElementById('ai-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('hidden'), 3000);
        });

        // --- Navigation Logic ---
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                const targetPageId = link.dataset.target;
                mainContentTitle.textContent = link.querySelector('span').textContent;

                contentPages.forEach(page => {
                    if (page.id === targetPageId) {
                        page.classList.remove('hidden');
                    } else {
                        page.classList.add('hidden');
                    }
                });
            });
        });

    </script>

    <!-- Main Layout -->
    <div class="min-h-screen flex">
        <!-- Left Sidebar (Navigation) -->
        <aside class="w-1/5 bg-white p-6 hidden md:block shadow-lg flex-shrink-0">
            <div class="flex items-center mb-8">
                <svg class="h-10 w-auto spoe-red-text" viewBox="0 0 100 100" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M50 0C22.4 0 0 22.4 0 50s22.4 50 50 50 50-22.4 50-50S77.6 0 50 0z"/><path d="M50 30c-11 0-20 9-20 20s9 20 20 20 20-9 20-20-9-20-20-20z"/></svg>
                <span class="ml-3 text-xl font-bold">Der OÖ-Plan</span>
            </div>
            <nav class="space-y-2">
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg active" data-target="page-home"><i data-lucide="home" class="mr-3"></i><span>Home / Feed</span></a>
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100" data-target="page-abstimmungen"><i data-lucide="bar-chart-2" class="mr-3"></i><span>Abstimmungen</span></a>
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100" data-target="page-veranstaltungen"><i data-lucide="calendar" class="mr-3"></i><span>Veranstaltungen</span></a>
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100" data-target="page-gruppen"><i data-lucide="users" class="mr-3"></i><span>Gruppen</span></a>
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100" data-target="page-bildung"><i data-lucide="book-open" class="mr-3"></i><span>Bildungsangebote</span></a>
                <a href="#" class="nav-link flex items-center p-2 text-lg font-semibold rounded-lg hover:bg-gray-100" data-target="page-toolbox"><i data-lucide="wrench" class="mr-3"></i><span>Toolbox</span></a>
            </nav>
            <div class="mt-10 p-4 bg-red-50 rounded-lg">
                <h3 class="font-bold spoe-red-text">KI-Workshops für Mandatare</h3>
                <p class="text-sm mt-2">Lerne, wie du KI für deine politische Arbeit nutzen kannst. Nächster Termin: 15.09.</p>
                <a href="#" class="text-sm font-semibold spoe-red-text mt-2 block">Jetzt anmelden &rarr;</a>
            </div>
        </aside>

        <!-- Center (Main Feed) -->
        <main class="w-full md:w-3/5 p-4 md:p-8 overflow-y-auto">
            <h2 id="main-content-title" class="text-2xl font-bold mb-4">Home / Feed</h2>
            
            <!-- Page: Home -->
            <div id="page-home" class="content-page">
                <div class="card p-4 mb-6">
                    <form id="idea-form">
                        <textarea id="idea-textarea" class="w-full p-2 border rounded-lg" rows="4" placeholder="Gestalte OÖ mit! Was ist deine Idee, dein Wunsch oder dein Anliegen..."></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <button type="button" id="ai-helper-btn" class="flex items-center text-sm text-gray-600 hover:spoe-red-text">
                                <i data-lucide="sparkles" class="mr-1 w-4 h-4"></i> Mit KI-Assistent verbessern
                            </button>
                            <button type="submit" class="btn-primary">Veröffentlichen</button>
                        </div>
                    </form>
                </div>
                <div class="flex space-x-2 mb-4">
                    <button class="px-4 py-1 text-sm font-semibold rounded-full active-filter">Alles</button>
                    <button class="px-4 py-1 text-sm font-semibold rounded-full bg-white hover:bg-gray-200">Meine Gemeinde</button>
                    <button class="px-4 py-1 text-sm font-semibold rounded-full bg-white hover:bg-gray-200">Mein Bezirk</button>
                </div>
                <div id="feed-container" class="space-y-4">
                    <div class="card p-4 text-center text-gray-500">Lade Ideen...</div>
                </div>
            </div>

            <!-- Other Pages (initially hidden) -->
            <div id="page-abstimmungen" class="content-page hidden"><div class="card p-8 text-center"><h3 class="text-xl font-bold">Monatliche Abstimmungen</h3><p class="mt-2 text-gray-600">Hier werden bald die Top-Ideen der Community zur Abstimmung gestellt.</p></div></div>
            <div id="page-veranstaltungen" class="content-page hidden"><div class="card p-8 text-center"><h3 class="text-xl font-bold">Veranstaltungskalender</h3><p class="mt-2 text-gray-600">Finde alle Termine, von der Sektionssitzung bis zum Sommerfest, in deiner Nähe.</p></div></div>
            <div id="page-gruppen" class="content-page hidden"><div class="card p-8 text-center"><h3 class="text-xl font-bold">Gruppen</h3><p class="mt-2 text-gray-600">Schließe dich mit Gleichgesinnten zusammen, um Projekte zu planen und umzusetzen.</p></div></div>
            <div id="page-bildung" class="content-page hidden"><div class="card p-8 text-center"><h3 class="text-xl font-bold">Bildungsangebote</h3><p class="mt-2 text-gray-600">Hier findest du alle Workshops, Rufseminare und Online-Kurse.</p></div></div>
            <div id="page-toolbox" class="content-page hidden"><div class="card p-8 text-center"><h3 class="text-xl font-bold">Toolbox</h3><p class="mt-2 text-gray-600">Anleitungen, Checklisten und Vorlagen für deine politische Arbeit vor Ort. Vom Spritzerstand bis zur Gemeindezeitung.</p></div></div>

        </main>

        <!-- Right Sidebar (Martin Winkler & Top-Themen) -->
        <aside class="w-1/5 bg-transparent p-6 hidden md:block flex-shrink-0">
            <div class="card p-4 mb-6 text-center">
                <img src="https://placehold.co/80x80/E30613/FFFFFF?text=MW" alt="Martin Winkler" class="rounded-full mx-auto mb-3">
                <h3 class="font-bold">Martin Winkler</h3>
                <p class="text-sm text-gray-600 mb-3">Unser Mann für OÖ</p>
                <p class="text-sm">"Wir übernehmen den Landtag nicht als Vision, sondern als Ziel. Diese Plattform ist unser Plan. Wir setzen um, wir reden nicht nur."</p>
            </div>
            <div class="card p-4">
                <h3 class="font-bold mb-3">Top-Thema des Monats</h3>
                <div class="space-y-3">
                    <div class="bg-red-50 p-3 rounded-lg">
                        <p class="text-sm font-bold">#LeistbaresWohnen</p>
                        <p class="text-xs mt-1">Die Community hat gevotet! Diesen Monat bündeln wir alle Kräfte für faire Mieten und mehr Gemeindewohnungen.</p>
                        <a href="#" class="text-xs font-semibold spoe-red-text mt-1 block">Mitmachen &rarr;</a>
                    </div>
                </div>
            </div>
             <div class="card p-4 mt-6">
                <h3 class="font-bold mb-3">KI-Analyse: Polit-Check</h3>
                <p class="text-sm">Unsere KI hat die letzte Rede des politischen Mitbewerbers analysiert. Hier sind die Fakten und unsere Antwortvorschläge.</p>
                <a href="#" class="text-sm font-semibold spoe-red-text mt-2 block">Zur Analyse &rarr;</a>
            </div>
        </aside>
    </div>

    <!-- AI Helper Modal -->
    <div id="ai-modal" class="hidden fixed top-5 right-5 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50">
        <p>KI-Assistent hat deinen Beitrag optimiert!</p>
    </div>

    <script>
        lucide.createIcons();
    </script>
</body>
</html>
